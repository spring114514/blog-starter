import { f as f$1 } from './chunk-NJ75GKD4.js';

var C=/\r?\n|\r/gm,M=class{constructor(t){let e=new $(t);this.writable=new WritableStream({write(i){e.transform(i);},close(){e.close();}}),this.readable=new ReadableStream({start(i){e.onLine=n=>i.enqueue(n),e.onClose=()=>i.close();}});}},$=class{constructor(t){this.n="",this.D=new TextDecoder(t);}transform(t){this.n+=this.D.decode(t,{stream:!0});let e=this.n.split(C);this.n=e.pop()||"";for(let i=0;i<e.length;i++)this.onLine(e[i].trim());}close(){this.n&&this.onLine(this.n.trim()),this.n="",this.onClose();}};async function ft(t,e){let i=new ReadableStream({start(n){let r=t.split(C);for(let s of r)n.enqueue(s);n.close();}});return S(i,e)}async function S(t,e){let i=e?.type??"vtt",n;if(typeof i=="string")switch(i){case"srt":n=(await import('./parse-OWSXII2A-2BJGM4TR.js')).default;break;case"ssa":case"ass":n=(await import('./parse-5AJVIO2J-LEZ3QR5W.js')).default;break;default:n=(await import('./parse-MMUDIPMV-H37KOFVE.js')).default;}else n=i;let r,s=t.getReader(),a=n(),o=!!e?.strict||!!e?.errors;await a.init({strict:!1,...e,errors:o,type:i,cancel(){s.cancel(),r=a.done(!0);}});let l=1;for(;;){let{value:h,done:c}=await s.read();if(c){a.parse("",l),r=a.done(!1);break}a.parse(h,l),l++;}return r}async function ut(t,e){let i=await t;if(!i.ok||!i.body){let a;return {metadata:{},cues:[],regions:[],errors:[a]}}let n=i.headers.get("content-type")||"",r=n.match(/text\/(.*?)(?:;|$)/)?.[1],s=n.match(/charset=(.*?)(?:;|$)/)?.[1];return E(i.body,{type:r,encoding:s,...e})}async function E(t,{encoding:e="utf-8",...i}={}){let n=t.pipeThrough(new M(e));return S(n,i)}var _=/[0-9]/,z=/[\s\t]+/,k={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span",timestamp:"span"},P={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&nbsp;":"\xA0","&lrm;":"\u200E","&rlm;":"\u200F"},V=/&(?:amp|lt|gt|quot|#(0+)?39|nbsp|lrm|rlm);/g,q=new Set(["white","lime","cyan","red","yellow","magenta","blue","black"]),H=new Set(Object.keys(k));function D(t){let e="",i=1,n=[],r=[],s;for(let h=0;h<t.text.length;h++){let c=t.text[h];switch(i){case 1:c==="<"?(l(),i=2):e+=c;break;case 2:switch(c){case`
`:case"	":case" ":a(),i=4;break;case".":a(),i=3;break;case"/":i=5;break;case">":a(),i=1;break;default:!e&&_.test(c)&&(i=6),e+=c;break}break;case 3:switch(c){case"	":case" ":case`
`:o(),s&&s.class?.trim(),i=4;break;case".":o();break;case">":o(),s&&s.class?.trim(),i=1;break;default:e+=c;}break;case 4:c===">"?(e=e.replace(z," "),s?.type==="v"?s.voice=y(e):s?.type==="lang"&&(s.lang=y(e)),e="",i=1):e+=c;break;case 5:c===">"&&(e="",s=r.pop(),i=1);break;case 6:if(c===">"){let d=f$1(e);d!==null&&d>=t.startTime&&d<=t.endTime&&(e="timestamp",a(),s.time=d),e="",i=1;}else e+=c;break}}function a(){if(H.has(e)){let h=s;s=F(e),h?(r[r.length-1]!==h&&r.push(h),h.children.push(s)):n.push(s);}e="",i=1;}function o(){if(s&&e){let h=e.replace("bg_","");q.has(h)?s[e.startsWith("bg_")?"bgColor":"color"]=h:s.class=s.class?s.class+" "+e:e;}e="";}function l(){if(!e)return;let h={type:"text",data:y(e)};s?s.children.push(h):n.push(h),e="";}return i===1&&l(),n}function F(t){return {tagName:k[t],type:t,children:[]}}function y(t){return t.replace(V,e=>P[e]||"'")}function f(t,e,i){t.style.setProperty(`--${e}`,i+"");}function u(t,e,i=!0){t.setAttribute(`data-${e}`,i===!0?"":i+"");}function g(t,e){t.setAttribute("part",e);}function X(t){return parseFloat(getComputedStyle(t).lineHeight)||0}function dt(t){let e=document.createElement("template");return e.innerHTML=R(t),{cue:t,content:e.content}}function R(t,e=0){return B(D(t),e)}function B(t,e=0){let i,n="";for(let r of t)if(r.type==="text")n+=r.data;else {let s=r.type==="timestamp";i={},i.class=r.class,i.title=r.type==="v"&&r.voice,i.lang=r.type==="lang"&&r.lang,i.part=r.type==="v"&&"voice",s&&(i.part="timed",i["data-time"]=r.time,i["data-future"]=r.time>e,i["data-past"]=r.time<e),i.style=`${r.color?`color: ${r.color};`:""}${r.bgColor?`background-color: ${r.bgColor};`:""}`;let a=Object.entries(i).filter(o=>o[1]).map(o=>`${o[0]}="${o[1]===!0?"":o[1]}"`).join(" ");n+=`<${r.tagName}${a?" "+a:""}>${B(r.children)}</${r.tagName}>`;}return n}function W(t,e){for(let i of t.querySelectorAll('[part="timed"]')){let n=Number(i.getAttribute("data-time"));Number.isNaN(n)||(n>e?u(i,"future"):i.removeAttribute("data-future"),n<e?u(i,"past"):i.removeAttribute("data-past"));}}var m=Symbol(0);function w(t){return t instanceof HTMLElement?{top:t.offsetTop,width:t.clientWidth,height:t.clientHeight,left:t.offsetLeft,right:t.offsetLeft+t.clientWidth,bottom:t.offsetTop+t.clientHeight}:{...t}}function T(t,e,i){switch(e){case"+x":t.left+=i,t.right+=i;break;case"-x":t.left-=i,t.right-=i;break;case"+y":t.top+=i,t.bottom+=i;break;case"-y":t.top-=i,t.bottom-=i;break}}function Y(t,e){return t.left<=e.right&&t.right>=e.left&&t.top<=e.bottom&&t.bottom>=e.top}function G(t,e){for(let i=0;i<e.length;i++)if(Y(t,e[i]))return e[i];return null}function b(t,e){return e.top>=0&&e.bottom<=t.height&&e.left>=0&&e.right<=t.width}function j(t,e,i){switch(i){case"+x":return e.left<0;case"-x":return e.right>t.width;case"+y":return e.top<0;case"-y":return e.bottom>t.height}}function Z(t,e){let i=Math.max(0,Math.min(t.width,e.right)-Math.max(0,e.left)),n=Math.max(0,Math.min(t.height,e.bottom)-Math.max(0,e.top));return i*n/(t.height*t.width)}function v(t,e){return {top:e.top/t.height,left:e.left/t.width,right:(t.width-e.right)/t.width,bottom:(t.height-e.bottom)/t.height}}function N(t,e){return e.top=e.top*t.height,e.left=e.left*t.width,e.right=t.width-e.right*t.width,e.bottom=t.height-e.bottom*t.height,e}var O=["top","left","right","bottom"];function L(t,e,i,n){let r=v(e,i);for(let s of O)f(t,`${n}-${s}`,r[s]*100+"%");}function x(t,e,i,n){let r=1,s,a={...e};for(let o=0;o<n.length;o++){for(;j(t,e,n[o])||b(t,e)&&G(e,i);)T(e,n[o],1);if(b(t,e))return e;let l=Z(t,e);r>l&&(s={...e},r=l),e={...a};}return s||a}var p=Symbol(0);function K(t,e,i,n){let r=i.firstElementChild,s=U(e),a,o=[];if(i[m]||(i[m]=J(t,i)),a=N(t,{...i[m]}),i[p])o=[i[p]==="top"?"+y":"-y","+x","-x"];else if(e.snapToLines){let l;switch(e.vertical){case"":o=["+y","-y"],l="height";break;case"rl":o=["+x","-x"],l="width";break;case"lr":o=["-x","+x"],l="width";break}let h=X(r),c=h*Math.round(s),d=t[l]+h,I=o[0];Math.abs(c)>d&&(c=c<0?-1:1,c*=Math.ceil(d/h)*h),s<0&&(c+=e.vertical===""?t.height:t.width,o=o.reverse()),T(a,I,c);}else {let l=e.vertical==="",h=l?"+y":"+x",c=l?a.height:a.width;T(a,h,(l?t.height:t.width)*s/100),T(a,h,e.lineAlign==="center"?c/2:e.lineAlign==="end"?c:0),o=l?["-y","+y","-x","+x"]:["-x","+x","-y","+y"];}return a=x(t,a,n,o),L(i,t,a,"cue"),a}function J(t,e){let i=w(e),n=Q(e);if(e[p]=!1,n.top&&(i.top=n.top,i.bottom=n.top+i.height,e[p]="top"),n.bottom){let r=t.height-n.bottom;i.top=r-i.height,i.bottom=r,e[p]="bottom";}return n.left&&(i.left=n.left),n.right&&(i.right=t.width-n.right),v(t,i)}function Q(t){let e={};for(let i of O)e[i]=parseFloat(t.style.getPropertyValue(`--cue-${i}`));return e}function U(t){return t.line==="auto"?t.snapToLines?-1:100:t.line}function tt(t){if(t.position==="auto")switch(t.align){case"start":case"left":return 0;case"right":case"end":return 100;default:return 50}return t.position}function et(t,e){if(t.positionAlign==="auto")switch(t.align){case"start":return e==="ltr"?"line-left":"line-right";case"end":return e==="ltr"?"line-right":"line-left";case"center":return "center";default:return `line-${t.align}`}return t.positionAlign}var it=["-y","+y","-x","+x"];function rt(t,e,i,n){let r=Array.from(i.querySelectorAll('[part="cue-display"]')),s=0,a=Math.max(0,r.length-e.lines);for(let l=r.length-1;l>=a;l--)s+=r[l].offsetHeight;f(i,"region-height",s+"px"),i[m]||(i[m]=v(t,w(i)));let o={...i[m]};return o=N(t,o),o.width=i.clientWidth,o.height=s,o.right=o.left+o.width,o.bottom=o.top+s,o=x(t,o,n,it),L(i,t,o,"region"),o}var mt=class{constructor(t,e){this.r=0,this.z="ltr",this.w=[],this.A=-1,this.s=-1,this.l=new Map,this.d=new Map,this.overlay=t,this.dir=e?.dir??"ltr",t.setAttribute("translate","yes"),t.setAttribute("aria-live","off"),t.setAttribute("aria-atomic","true"),g(t,"captions"),this.N(),this.B=new ResizeObserver(this.X.bind(this)),this.B.observe(t);}get dir(){return this.z}set dir(t){this.z=t,u(this.overlay,"dir",t);}get currentTime(){return this.r}set currentTime(t){this.r=t,this.update();}changeTrack({regions:t,cues:e}){this.reset(),this.Y(t);for(let i of e)this.d.set(i,null);this.update();}addCue(t){this.d.set(t,null),this.update();}removeCue(t){this.d.delete(t),this.update();}update(t=!1){this.s>=0||(this.s=requestAnimationFrame(()=>{this.O(t),this.s=-1;}));}reset(){cancelAnimationFrame(this.s),this.s=-1,this.d.clear(),this.l.clear(),this.w=[],this.overlay.textContent="";}destroy(){this.reset(),this.B.disconnect();}X(){this.A>=0||(this.A=requestAnimationFrame(()=>{this.N(),this.A=-1,this.l.size&&this.O(!0);}));}N(){this.q=w(this.overlay),f(this.overlay,"overlay-width",this.q.width+"px"),f(this.overlay,"overlay-height",this.q.height+"px");}O(t=!1){if(!this.d.size)return;let e,i=[...this.d.keys()].filter(r=>this.r>=r.startTime&&this.r<=r.endTime).sort((r,s)=>r.startTime!==s.startTime?r.startTime-s.startTime:r.endTime-s.endTime),n=i.map(r=>r.region);for(let r=0;r<this.w.length;r++){if(e=this.w[r],i[r]===e)continue;if(e.region&&!n.includes(e.region)){let a=this.l.get(e.region.id);a&&(a.removeAttribute("data-active"),t=!0);}let s=this.d.get(e);s&&(s.remove(),t=!0);}for(let r=0;r<i.length;r++){e=i[r];let s=this.d.get(e);s||this.d.set(e,s=this.Z(e));let a=this.C(e)&&this.l.get(e.region.id);a&&!a.hasAttribute("data-active")&&(requestAnimationFrame(()=>{u(a,"active");}),t=!0),s.isConnected||((a||this.overlay).append(s),t=!0);}if(t){let r=[],s=new Set;for(let a=i.length-1;a>=0;a--){if(e=i[a],s.has(e.region||e))continue;let o=this.C(e),l=o?this.l.get(e.region.id):this.d.get(e);o?r.push(rt(this.q,e.region,l,r)):r.push(K(this.q,e,l,r)),s.add(o?e.region:e);}}W(this.overlay,this.r),this.w=i;}Y(t){if(t)for(let e of t){let i=this.jn(e);i&&(this.l.set(e.id,i),this.overlay.append(i));}}jn(t){let e=document.createElement("div");return g(e,"region"),u(e,"id",t.id),u(e,"scroll",t.scroll),f(e,"region-width",t.width+"%"),f(e,"region-anchor-x",t.regionAnchorX),f(e,"region-anchor-y",t.regionAnchorY),f(e,"region-viewport-anchor-x",t.viewportAnchorX),f(e,"region-viewport-anchor-y",t.viewportAnchorY),f(e,"region-lines",t.lines),e}Z(t){let e=document.createElement("div"),i=tt(t),n=et(t,this.z);if(g(e,"cue-display"),t.vertical!==""&&u(e,"vertical"),f(e,"cue-text-align",t.align),t.style)for(let s of Object.keys(t.style))e.style.setProperty(s,t.style[s]);if(this.C(t))f(e,"cue-offset",`${i-(n==="line-right"?100:n==="center"?50:0)}%`);else if(f(e,"cue-writing-mode",t.vertical===""?"horizontal-tb":t.vertical==="lr"?"vertical-lr":"vertical-rl"),!t.style?.["--cue-width"]){let s=i;n==="line-left"?s=100-i:n==="center"&&i<=50?s=i*2:n==="center"&&i>50&&(s=(100-i)*2);let a=t.size<s?t.size:s;t.vertical===""?f(e,"cue-width",a+"%"):f(e,"cue-height",a+"%");}let r=document.createElement("div");return g(r,"cue"),t.id&&u(r,"id",t.id),r.innerHTML=R(t),e.append(r),e}C(t){return t.region&&t.size===100&&t.vertical===""&&t.line==="auto"}};

export { ft as a, S as b, ut as c, E as d, D as e, dt as f, R as g, B as h, W as i, mt as j };
